<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="description" content="JavaScript/TypeScript implementation of the Impossible Bridge Book" />
  <meta charset="utf-8">
  <title>The Impossible Bridge Book: JavaScript edition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Thomas Andrews">
  <!-- <link rel="stylesheet" href="css/style.css"> -->
  <script src="http://code.jquery.com/jquery-latest.min.js"></script>
</head>

<body>
  
<div class="container">
 <form name="lookup" id='lookup' onsubmit='return false;'>
Page Number(s):
 <div>
  <input type='text' id='pageNo' name='pageNumbers' maxlength='1000'  size='70'></input>
  </div><div>
 <select name="scramble">
    <option value="">Normal</option>
    <option value="Scrambled">Scrambled</option>
 </select>
 <select name="edition">
    <option value="Andrews">Andrews Edition</option>
    <option value="Pavlicek">Pavlicek Edition</option>
 </select>
<input type="submit" value="Lookup"></input> 
</div>

</form>
<div id='error'></div>
<div style='display: none;' id='deal'>
  <h3><a href='#' id='back'>&lt;&lt;</a>
    Deal <span id='dealIndex'></span> of <span id='dealCount'></span> 
    <a href='#' id='forward'>&gt;&gt;</a></h3>

  <h1 id="bookTitle"></h1>
  <h2>Page <span id='pageNumber'></span> </h2>
  <pre id='hands'></pre>
</div>
</div>

<script type="module">

      import { Application } from "./application.js"
      var App = new Application()

      function updateCurrentDeal(index,dealInfo) {
          console.log("Index: ",index)
          var dealLoc = $('#deal')
          if (dealInfo == undefined) {
            dealLoc.hide()
            console.log('Undefined')
            return
          } else {
            $('#dealIndex').text(index+1)
            var title = dealInfo.edition + " Edition"
            if (dealInfo.scrambled) {
              title = "Scrambled "+ title
            }
            $('#bookTitle').text(title)
            $('#error').hide()
            $('#pageNumber').text(dealInfo.pageNo)
            $('#back').toggle(App.allowPrevious)
            $('#forward').toggle(App.allowNext)
            var hands = dealInfo.deal.hands.map((hand) => hand.toString()).join("\n")
            $('#hands').text(hands)
            dealLoc.show()
          }
      }

      function updateDealCount(count) {
        $('#dealCount').text(count)
      }
            
      function initialize() {
          App.listenCurrentDeal(updateCurrentDeal)
          App.listenDealCount(updateDealCount)
          const form = $('#lookup')
          form.submit(() => {
              submit_pages(form)
              return false;
          }) 
          $('#back').on('click',() => App.previousDeal())
          $('#forward').on('click',() => App.nextDeal())
          App.reset()
      }



      function submit_pages(form) {
        try {

          var page = form.find('input[name="pageNumbers"]').val()
          var scramble = form.find('select[name="scramble"]').val()
          var edition = form.find('select[name="edition"]').val()
          App.findDeal(edition,scramble=='Scrambled',BigInt(page))
          $('#error').hide()
        } catch (e) {

          console.error(e)
          $('#error').text(e)
          $('#error').show()
          return false

        }
      }

      $(document).ready(() => initialize())

</script>

</body>
</html>


