<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="description" content="JavaScript/TypeScript implementation of the Impossible Bridge Book" />
  <meta charset="utf-8">
  <title>The Impossible Bridge Book: JavaScript edition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Thomas Andrews">
  <!-- <link rel="stylesheet" href="css/style.css"> -->
  <script src="http://code.jquery.com/jquery-latest.min.js"></script>
</head>

<body>
  
<div class="container">
 <form name="lookup" id='lookup' onsubmit='return false;'>
Page Number(s):
 <input type='text' id='pageNo' name='pageNumbers' maxlength='1000'  size='70'></input>
 <select name="scramble">
    <option value="">Normal</option>
    <option value="Scrambled">Scrambled</option>
 </select>
 <select name="edition">
    <option value="Andrews">Andrews Edition</option>
    <option value="Pavlicek">Pavlicek Edition</option>
 </select>
<input type="submit" value="Lookup"></input> 

</form>
<pre id='toWhom'>
</pre>
</div>

    <script type="module">

      import { AndrewsStrategy, PavlicekStrategy,scramble_book} from "./numeric/book.js"

      function make_scrambler() {
        var multiplier = BigInt("13109994191499930367061460371")
        var translation = BigInt("34563463456363563565356345634")
        return (book) => scramble_book(book,multiplier,translation)
      }

      function make_books() {
        var scrambler = make_scrambler()
        var aBook = new AndrewsStrategy()
        var pBook = new PavlicekStrategy()
        return { 
          Andrews: [aBook,scrambler(aBook)],
          Pavlicek: [pBook,scrambler(aBook)]
        }

    }
      // global variable
      var books =  make_books()
    
      function initialize() {
          const form = $('#lookup')
          form.submit(() => {
              submit_pages(form)
              return false;
          }) 
      }

      function get_named_book(edition,scramble) {
        var editions = books[edition] 
        var book, title;
        if (scramble=='Scrambled') {
            title = edition + ' Scrambled'
            book = editions[1];
        } else {
            title = edition
            book = editions[0];
        }
        return { book: book, title: title, edition: edition, scramble: scramble }        
      }

      function determine_named_book(form) {
        if (form == undefined) {
            form = $('#lookup')
        }
        var scramble = form.find('select[name="scramble"]').val()
          var edition = form.find('select[name="edition"]').val()
          return get_named_book(edition,scramble)
          var editions = books[edition]
          var book, title;
          if (scramble=='Scrambled') {
            title = edition + ' Scrambled'
            book = editions[1];
          } else {
            title = edition
            book = editions[0];
          }
          return { book: book, title: title }

      }

      function submit_pages(form) {
          var page = form.find('input[name="pageNumbers"]').val()
          var namedBook = determine_named_book(form)
          var pageNo = BigInt(page)
          processBookPage(namedBook,pageNo)
        }

        function processBookPage(namedBook,pageNo) {
          var deal = namedBook.book.computePageContent(pageNo)
          var text = 'Page ' + pageNo.toString() + ' of edition ' + namedBook.title + '\n'
          text += deal.toWhom.toString()+'\n'
          deal.hands.forEach((hand,seat) => {
              text += 'Seat ' + seat +' gets cards {}' + hand.toString() + '}\n'
          })
          $('#toWhom').prepend(text+"\n")
      }

      function powers_of_ten() {
        var namedBook = determine_named_book()
        var pages = namedBook.book.signature.pages
        for (var pageNo = BigInt(1); pageNo<pages; pageNo *= BigInt(10)) {
            processBookPage(namedBook,pageNo)
        }
      }

      initialize()

   </script>

</body>
</html>


