<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="description" content="JavaScript/TypeScript implementation of the Impossible Bridge Book" />
  <meta charset="utf-8">
  <title>The Impossible Bridge Book: JavaScript edition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Thomas Andrews">
  <!-- <link rel="stylesheet" href="css/style.css"> -->
  <script src="http://code.jquery.com/jquery-latest.min.js"></script>
</head>

<body>
  
<div class="container">
 <form name="lookup" id='lookup' onsubmit='return false;'>
Page Number(s):
 <input type='text' id='pageNo' name='pageNumbers' maxlength='1000'  size='70'></input>
 <select name="scramble">
    <option value="">Normal</option>
    <option value="Scrambled">Scrambled</option>
 </select>
 <select name="edition">
    <option value="Andrews">Andrews Edition</option>
    <option value="Pavlicek">Pavlicek Edition</option>
 </select>
<input type="submit" value="Lookup"></input> 

</form>
<pre id='deal'>
</pre>
</div>

<script type="module">

      import { Application } from "./application.js"
      var App = new Application()

      function updateCurrentDeal(index,dealInfo) {
          console.log("Index: ",index)
          var dealLoc = $('#deal')
          if (dealInfo == undefined) {
            dealLoc.text('Nothing to see')
          } else {
            var title = dealInfo.edition + " Edition"
            if (dealInfo.scrambled) {
              title = "Scrambled "+ title
            }
            var text = title + "\n" + "Page " + dealInfo.pageNo + "\n"
            var hands = dealInfo.deal.hands.map((hand) => hand.toString()).join("\n")
            dealLoc.text(text+hands)
          }
      }

      function updateDealCount(count) {

      }
            
      function initialize() {
          App.listenCurrentDeal(updateCurrentDeal)
          App.listenDealCount(updateDealCount)
          const form = $('#lookup')
          form.submit(() => {
              submit_pages(form)
              return false;
          }) 
      }



      function submit_pages(form) {
        try {

          var page = form.find('input[name="pageNumbers"]').val()
          var scramble = form.find('select[name="scramble"]').val()
          var edition = form.find('select[name="edition"]').val()
          App.findDeal(edition,scramble=='Scrambled',BigInt(page))
        } catch (e) {
          console.error(e)
          $('#deal').text(e)

        }
      }

      initialize()

</script>

</body>
</html>


